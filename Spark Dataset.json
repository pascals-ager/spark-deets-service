{"paragraphs":[{"text":"val pageTurnsSrc = \"hdfs://node-master:8020/tmp/page_turns.json\"\nval brochuresClickSrc = \"hdfs://node-master:8020/tmp/brochure_clicks.json\"\nval entersSrc = \"hdfs://node-master:8020/tmp/enters.json\"\nval exitsSrc = \"hdfs://node-master:8020/tmp/exits.json\"","user":"anonymous","dateUpdated":"2019-07-21T22:12:56+0200","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"pageTurnsSrc: String = hdfs://node-master:8020/tmp/page_turns.json\nbrochuresClickSrc: String = hdfs://node-master:8020/tmp/brochure_clicks.json\nentersSrc: String = hdfs://node-master:8020/tmp/enters.json\nexitsSrc: String = hdfs://node-master:8020/tmp/exits.json\n"}]},"apps":[],"jobName":"paragraph_1563711550985_1722163948","id":"20190720-224646_669189241","dateCreated":"2019-07-21T14:19:10+0200","dateStarted":"2019-07-21T22:12:56+0200","dateFinished":"2019-07-21T22:12:59+0200","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:4139"},{"text":"trait PageView{\n    def page: Option[Long]\n    def page_view_mode: Option[String]\n    def user_agent: Option[String]\n}","user":"anonymous","dateUpdated":"2019-07-21T22:12:59+0200","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"defined trait PageView\n"}]},"apps":[],"jobName":"paragraph_1563711551012_-1046991874","id":"20190721-040217_1200282832","dateCreated":"2019-07-21T14:19:11+0200","dateStarted":"2019-07-21T22:12:59+0200","dateFinished":"2019-07-21T22:13:06+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4140"},{"text":"case class BrochureClick(brochure_click_id: Option[Long], brochure_click_uuid: Option[String], brochure_id: Option[Long], date_time: Option[String], event: Option[String], ip: Option[String], location_device_lat: Option[Double], location_device_lng: Option[Double], location_intended_lat: Option[Double], location_intended_lng: Option[Double], no_profile: Option[Boolean], page: Option[Long], page_type: Option[String], restricted_ip: Option[Boolean], traffic_source_type: Option[String], traffic_source_value: Option[String], treatment: Option[String], user_agent: Option[String], user_ident: Option[String], user_zip: Option[String], visit_id: Option[Long], visit_origin_type: Option[String])\ncase class PageTurn(brochure_click_uuid: Option[String], date_time: Option[String], event: Option[String], ip_address: Option[String], override val page: Option[Long], override val page_view_mode: Option[String], override val user_agent: Option[String]) extends PageView\ncase class PageEnter(brochure_click_uuid: Option[String], date_time: Option[String], event: Option[String], ip_address: Option[String], override val page: Option[Long], override val page_view_mode: Option[String], screen_size: Option[String], override val user_agent: Option[String]) extends PageView\ncase class PageExit(brochure_click_uuid: Option[String], date_time: Option[String], event: Option[String], ip_address: Option[String], override val page: Option[Long], override val page_view_mode: Option[String], override val user_agent: Option[String]) extends PageView","user":"anonymous","dateUpdated":"2019-07-21T22:13:06+0200","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{"0":{"graph":{"mode":"table","height":243.15,"optionOpen":false}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"defined class BrochureClick\ndefined class PageTurn\ndefined class PageEnter\ndefined class PageExit\n"}]},"apps":[],"jobName":"paragraph_1563711551014_1251350549","id":"20190720-230005_1090892820","dateCreated":"2019-07-21T14:19:11+0200","dateStarted":"2019-07-21T22:13:07+0200","dateFinished":"2019-07-21T22:13:21+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4141"},{"text":"val brochureClick = spark.read.json(brochuresClickSrc).as[BrochureClick]\nval pageTurn = spark.read.json(pageTurnsSrc).as[PageTurn]\nval pageEnter = spark.read.json(entersSrc).as[PageEnter]\nval pageExit = spark.read.json(exitsSrc).as[PageExit]","user":"anonymous","dateUpdated":"2019-07-21T22:13:21+0200","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"brochureClick: org.apache.spark.sql.Dataset[BrochureClick] = [brochure_click_id: bigint, brochure_click_uuid: string ... 20 more fields]\npageTurn: org.apache.spark.sql.Dataset[PageTurn] = [brochure_click_uuid: string, date_time: string ... 5 more fields]\npageEnter: org.apache.spark.sql.Dataset[PageEnter] = [brochure_click_uuid: string, date_time: string ... 6 more fields]\npageExit: org.apache.spark.sql.Dataset[PageExit] = [brochure_click_uuid: string, date_time: string ... 5 more fields]\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://node-two:36753/jobs","http://node-two:36753/jobs","http://node-two:36753/jobs","http://node-two:36753/jobs"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1563711551019_178807740","id":"20190720-230345_516575401","dateCreated":"2019-07-21T14:19:11+0200","dateStarted":"2019-07-21T22:13:22+0200","dateFinished":"2019-07-21T22:14:02+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4142"},{"text":"case class ClickEvent(user_ident: Option[String], page_view_mode: Option[String])\ncase class UserEventCount(user_ident: Option[String], event_count: Option[Int])\ncase class UserEventTotal(user_ident: Option[String], total_events: Option[BigInt])","user":"anonymous","dateUpdated":"2019-07-21T22:14:02+0200","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"defined class ClickEvent\ndefined class UserEventCount\ndefined class UserEventTotal\n"}]},"apps":[],"jobName":"paragraph_1563711551021_-1065436541","id":"20190721-023657_909144812","dateCreated":"2019-07-21T14:19:11+0200","dateStarted":"2019-07-21T22:14:03+0200","dateFinished":"2019-07-21T22:14:12+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4143"},{"text":"import org.apache.spark.sql.Dataset\nval datasets = Seq(pageTurn, pageEnter, pageExit)","user":"anonymous","dateUpdated":"2019-07-21T22:14:12+0200","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql.Dataset\ndatasets: Seq[org.apache.spark.sql.Dataset[_ >: PageExit with PageEnter with PageTurn <: Product with Serializable with PageView]] = List([brochure_click_uuid: string, date_time: string ... 5 more fields], [brochure_click_uuid: string, date_time: string ... 6 more fields], [brochure_click_uuid: string, date_time: string ... 5 more fields])\n"}]},"apps":[],"jobName":"paragraph_1563711551025_-1628343093","id":"20190721-024038_289466959","dateCreated":"2019-07-21T14:19:11+0200","dateStarted":"2019-07-21T22:14:12+0200","dateFinished":"2019-07-21T22:14:16+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4144"},{"text":"def transformDS(datasets: => Seq[org.apache.spark.sql.Dataset[_ >: PageExit with PageEnter with PageTurn <: Product with Serializable with PageView]]) : Seq[org.apache.spark.sql.Dataset[UserEventTotal]] = datasets.map {\n    ds => {\n        \n        brochureClick.joinWith(ds, brochureClick.col(\"brochure_click_uuid\") === ds.col(\"brochure_click_uuid\"), \"left\").map{\n            case (click: BrochureClick, turn: PageView) => ClickEvent(click.user_ident, turn.page_view_mode)\n            case (click: BrochureClick, null) => ClickEvent(click.user_ident, Some(\"None\"))\n        }.map {\n            case ClickEvent(user_ident, Some(\"DOUBLE_PAGE_MODE\")) => UserEventCount(user_ident, Some(2))\n            case ClickEvent(user_ident, Some(\"SINGLE_PAGE_MODE\")) => UserEventCount(user_ident, Some(1))\n            case ClickEvent(user_ident, Some(\"None\")) => UserEventCount(user_ident, Some(0))\n        }.groupBy(\"user_ident\").agg(sum(\"event_count\") as \"total_events\").as[UserEventTotal]\n    }\n\n}","user":"anonymous","dateUpdated":"2019-07-21T22:14:16+0200","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"transformDS: (datasets: => Seq[org.apache.spark.sql.Dataset[_ >: PageExit with PageEnter with PageTurn <: Product with Serializable with PageView]])Seq[org.apache.spark.sql.Dataset[UserEventTotal]]\n"}]},"apps":[],"jobName":"paragraph_1563711551032_-1502178383","id":"20190721-030833_1415650687","dateCreated":"2019-07-21T14:19:11+0200","dateStarted":"2019-07-21T22:14:16+0200","dateFinished":"2019-07-21T22:14:21+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4145"},{"text":"val transformedDS = transformDS(datasets)","user":"anonymous","dateUpdated":"2019-07-21T23:21:28+0200","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"transformedDS: Seq[org.apache.spark.sql.Dataset[UserEventTotal]] = List([user_ident: string, total_events: bigint], [user_ident: string, total_events: bigint], [user_ident: string, total_events: bigint])\n"}]},"apps":[],"jobName":"paragraph_1563711551034_-453597577","id":"20190721-041930_927150138","dateCreated":"2019-07-21T14:19:11+0200","dateStarted":"2019-07-21T23:21:28+0200","dateFinished":"2019-07-21T23:21:31+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4146"},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1563749901970_-2078548773","id":"20190722-005821_1848062047","dateCreated":"2019-07-22T00:58:21+0200","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5868","text":"val pageTurnTransformedDS = transformedDS.head\nval pageEnterTransformedDS = transformedDS.tail.head\nval pageExitTransformedDS = transformedDS.tail.tail.head","dateUpdated":"2019-07-22T00:59:25+0200","dateFinished":"2019-07-22T00:59:27+0200","dateStarted":"2019-07-22T00:59:26+0200","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"pageTurnTransformedDS: org.apache.spark.sql.Dataset[UserEventTotal] = [user_ident: string, total_events: bigint]\npageEnterTransformedDS: org.apache.spark.sql.Dataset[UserEventTotal] = [user_ident: string, total_events: bigint]\npageExitTransformedDS: org.apache.spark.sql.Dataset[UserEventTotal] = [user_ident: string, total_events: bigint]\n"}]}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1563750393033_-102374321","id":"20190722-010633_774376870","dateCreated":"2019-07-22T01:06:33+0200","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:6170","text":"case class UserDeetsDescription(user_ident: Option[String], total_views: Option[BigInt], total_enters:  Option[BigInt], total_exits:  Option[BigInt])","dateUpdated":"2019-07-22T01:08:46+0200","dateFinished":"2019-07-22T01:08:47+0200","dateStarted":"2019-07-22T01:08:46+0200","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"defined class UserDeetsDescription\n"}]}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1563750085607_473471930","id":"20190722-010125_596160627","dateCreated":"2019-07-22T01:01:25+0200","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:6066","text":"val tempDS = pageTurnTransformedDS.joinWith(pageEnterTransformedDS, pageTurnTransformedDS.col(\"user_ident\") === pageEnterTransformedDS.col(\"user_ident\"), \"inner\").map {\n    case (view: UserEventTotal, turns: UserEventTotal) => UserDeetsDescription(view.user_ident, view.total_events, turns.total_events, Some(0))\n}","dateUpdated":"2019-07-22T01:14:00+0200","dateFinished":"2019-07-22T01:14:02+0200","dateStarted":"2019-07-22T01:14:00+0200","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"tempDS: org.apache.spark.sql.Dataset[UserDeetsDescription] = [user_ident: string, total_views: decimal(38,0) ... 2 more fields]\n"}]}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1563750652266_-1382104763","id":"20190722-011052_2096198213","dateCreated":"2019-07-22T01:10:52+0200","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:6291","text":"tempDS.joinWith(pageExitTransformedDS, tempDS.col(\"user_ident\") === pageExitTransformedDS.col(\"user_ident\"), \"inner\").map {\n    case(deets: UserDeetsDescription, exits: UserEventTotal) => UserDeetsDescription(deets.user_ident, deets.total_views, deets.total_enters, exits.total_events)\n}.show()","dateUpdated":"2019-07-22T01:17:55+0200","dateFinished":"2019-07-22T01:18:17+0200","dateStarted":"2019-07-22T01:17:56+0200","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+-----------+------------+-----------+\n|          user_ident|total_views|total_enters|total_exits|\n+--------------------+-----------+------------+-----------+\n|01475b09-aa3e-432...|          0|           1|          1|\n|a53bc825-baa2-4f8...|         32|           1|          0|\n|7857bdd0-c7f0-4a2...|          0|           1|          1|\n|F85CBA86-4235-419...|          3|           1|          1|\n|b513b27e-470f-405...|         19|           1|          1|\n|1d11ba6f-d70d-42b...|         14|           1|          1|\n|1c787be4-50af-4ac...|          0|           1|          0|\n|c1e2e57d-fc17-472...|         31|           1|          1|\n|b27f05d4-0754-42b...|         10|           1|          0|\n|3b1feb0b-c2f4-4da...|          0|           1|          0|\n|4dc8ec5d-303d-4b4...|          0|           1|          1|\n|1DD2DCD8-78D1-440...|         46|           1|          1|\n|b5235b8c-32e0-480...|          0|           1|          0|\n|a4e2a425-20bc-4f9...|          8|           1|          1|\n|a1085c7a-3116-4d0...|          0|           3|          3|\n|7C2F34AC-7D0B-40F...|         14|           1|          1|\n|84361a5c-77a3-426...|         44|           1|          2|\n|22c49150-dcf7-4ed...|         33|           1|          1|\n|98dbada0-46ad-4ec...|         54|           5|          3|\n|     146360126356971|         60|           4|          4|\n+--------------------+-----------+------------+-----------+\nonly showing top 20 rows\n\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://node-two:36753/jobs","http://node-two:36753/jobs","http://node-two:36753/jobs","http://node-two:36753/jobs","http://node-two:36753/jobs","http://node-two:36753/jobs","http://node-two:36753/jobs","http://node-two:36753/jobs"],"interpreterSettingId":"spark"}}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1563750914555_1128674244","id":"20190722-011514_220154149","dateCreated":"2019-07-22T01:15:14+0200","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:6436"}],"name":"Spark Dataset","id":"2EG41NVPG","noteParams":{},"noteForms":{},"angularObjects":{"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{},"checkpoint":{"message":"v3.0"}}