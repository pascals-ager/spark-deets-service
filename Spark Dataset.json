{"paragraphs":[{"text":"val pageTurnsSrc = \"hdfs://node-master:8020/tmp/page_turns.json\"\nval brochuresClickSrc = \"hdfs://node-master:8020/tmp/brochure_clicks.json\"\nval entersSrc = \"hdfs://node-master:8020/tmp/enters.json\"\nval exitsSrc = \"hdfs://node-master:8020/tmp/exits.json\"","user":"anonymous","dateUpdated":"2019-07-21T14:19:10+0200","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"pageTurnsSrc: String = hdfs://node-master:8020/tmp/page_turns.json\nbrochuresClickSrc: String = hdfs://node-master:8020/tmp/brochure_clicks.json\nentersSrc: String = hdfs://node-master:8020/tmp/enters.json\nexitsSrc: String = hdfs://node-master:8020/tmp/exits.json\n"}]},"apps":[],"jobName":"paragraph_1563711550985_1722163948","id":"20190720-224646_669189241","dateCreated":"2019-07-21T14:19:10+0200","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:2136"},{"text":"trait PageView{\n    def page: Option[Long]\n    def page_view_mode: Option[String]\n    def user_agent: Option[String]\n}","user":"anonymous","dateUpdated":"2019-07-21T14:19:11+0200","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"defined trait PageView\n"}]},"apps":[],"jobName":"paragraph_1563711551012_-1046991874","id":"20190721-040217_1200282832","dateCreated":"2019-07-21T14:19:11+0200","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2137"},{"text":"case class BrochureClick(brochure_click_id: Option[Long], brochure_click_uuid: Option[String], brochure_id: Option[Long], date_time: Option[String], event: Option[String], ip: Option[String], location_device_lat: Option[Double], location_device_lng: Option[Double], location_intended_lat: Option[Double], location_intended_lng: Option[Double], no_profile: Option[Boolean], page: Option[Long], page_type: Option[String], restricted_ip: Option[Boolean], traffic_source_type: Option[String], traffic_source_value: Option[String], treatment: Option[String], user_agent: Option[String], user_ident: Option[String], user_zip: Option[String], visit_id: Option[Long], visit_origin_type: Option[String])\ncase class PageTurn(brochure_click_uuid: Option[String], date_time: Option[String], event: Option[String], ip_address: Option[String], override val page: Option[Long], override val page_view_mode: Option[String], override val user_agent: Option[String]) extends PageView\ncase class PageEnter(brochure_click_uuid: Option[String], date_time: Option[String], event: Option[String], ip_address: Option[String], override val page: Option[Long], override val page_view_mode: Option[String], screen_size: Option[String], override val user_agent: Option[String]) extends PageView\ncase class PageExit(brochure_click_uuid: Option[String], date_time: Option[String], event: Option[String], ip_address: Option[String], override val page: Option[Long], override val page_view_mode: Option[String], override val user_agent: Option[String]) extends PageView","user":"anonymous","dateUpdated":"2019-07-21T14:19:11+0200","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{"0":{"graph":{"mode":"table","height":243.15,"optionOpen":false}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"defined class BrochureClick\ndefined class PageTurn\ndefined class PageEnter\ndefined class PageExit\n"}]},"apps":[],"jobName":"paragraph_1563711551014_1251350549","id":"20190720-230005_1090892820","dateCreated":"2019-07-21T14:19:11+0200","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2138"},{"text":"val brochureClick = spark.read.json(brochuresClickSrc).as[BrochureClick]\nval pageTurn = spark.read.json(pageTurnsSrc).as[PageTurn]\nval pageEnter = spark.read.json(entersSrc).as[PageEnter]\nval pageExit = spark.read.json(exitsSrc).as[PageExit]","user":"anonymous","dateUpdated":"2019-07-21T14:19:11+0200","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"brochureClick: org.apache.spark.sql.Dataset[BrochureClick] = [brochure_click_id: bigint, brochure_click_uuid: string ... 20 more fields]\npageTurn: org.apache.spark.sql.Dataset[PageTurn] = [brochure_click_uuid: string, date_time: string ... 5 more fields]\npageEnter: org.apache.spark.sql.Dataset[PageEnter] = [brochure_click_uuid: string, date_time: string ... 6 more fields]\npageExit: org.apache.spark.sql.Dataset[PageExit] = [brochure_click_uuid: string, date_time: string ... 5 more fields]\n"}]},"apps":[],"jobName":"paragraph_1563711551019_178807740","id":"20190720-230345_516575401","dateCreated":"2019-07-21T14:19:11+0200","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2139"},{"text":"case class ClickEvent(user_ident: Option[String], page_view_mode: Option[String])\ncase class UserEventCount(user_ident: Option[String], event_count: Option[Int])\ncase class UserEventTotal(user_ident: Option[String], total_events: Option[BigInt])","user":"anonymous","dateUpdated":"2019-07-21T14:19:11+0200","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"defined class ClickEvent\ndefined class UserEventCount\ndefined class UserEventTotal\n"}]},"apps":[],"jobName":"paragraph_1563711551021_-1065436541","id":"20190721-023657_909144812","dateCreated":"2019-07-21T14:19:11+0200","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2140"},{"text":"val userViewTotalDS = brochureClick.joinWith(pageTurn, brochureClick.col(\"brochure_click_uuid\") === pageTurn.col(\"brochure_click_uuid\"), \"left\").map{\n    case (click: BrochureClick, null) => ClickEvent(click.user_ident, Some(\"None\"))\n    case (click: BrochureClick, turn: PageTurn) => ClickEvent(click.user_ident, turn.page_view_mode)\n}.map {\n    case ClickEvent(user_ident, Some(\"DOUBLE_PAGE_MODE\")) => UserEventCount(user_ident, Some(2))\n    case ClickEvent(user_ident, Some(\"SINGLE_PAGE_MODE\")) => UserEventCount(user_ident, Some(1))\n    case ClickEvent(user_ident, Some(\"None\")) => UserEventCount(user_ident, Some(0))\n}.groupBy(\"user_ident\").agg(sum(\"event_count\") as \"total_events\").as[UserEventTotal]\n\nuserViewTotalDS.show()","user":"anonymous","dateUpdated":"2019-07-21T14:19:11+0200","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"userViewTotalDS: org.apache.spark.sql.Dataset[UserEventTotal] = [user_ident: string, total_events: bigint]\n+--------------------+------------+\n|          user_ident|total_events|\n+--------------------+------------+\n|01475b09-aa3e-432...|           0|\n|a53bc825-baa2-4f8...|          32|\n|7857bdd0-c7f0-4a2...|           0|\n|F85CBA86-4235-419...|           3|\n|b513b27e-470f-405...|          19|\n|1d11ba6f-d70d-42b...|          14|\n|1c787be4-50af-4ac...|           0|\n|c1e2e57d-fc17-472...|          31|\n|b27f05d4-0754-42b...|          10|\n|3b1feb0b-c2f4-4da...|           0|\n|4dc8ec5d-303d-4b4...|           0|\n|1DD2DCD8-78D1-440...|          46|\n|b5235b8c-32e0-480...|           0|\n|a4e2a425-20bc-4f9...|           8|\n|a1085c7a-3116-4d0...|           0|\n|7C2F34AC-7D0B-40F...|          14|\n|84361a5c-77a3-426...|          44|\n|22c49150-dcf7-4ed...|          33|\n|98dbada0-46ad-4ec...|          54|\n|     146360126356971|          60|\n+--------------------+------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1563711551023_653112217","id":"20190721-021012_1041433424","dateCreated":"2019-07-21T14:19:11+0200","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2141"},{"text":"import org.apache.spark.sql.Dataset\nval datasets = Seq(pageTurn, pageEnter, pageExit)","user":"anonymous","dateUpdated":"2019-07-21T14:19:11+0200","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql.Dataset\ndatasets: Seq[org.apache.spark.sql.Dataset[_ >: PageExit with PageEnter with PageTurn <: Product with Serializable with PageView]] = List([brochure_click_uuid: string, date_time: string ... 5 more fields], [brochure_click_uuid: string, date_time: string ... 6 more fields], [brochure_click_uuid: string, date_time: string ... 5 more fields])\n"}]},"apps":[],"jobName":"paragraph_1563711551025_-1628343093","id":"20190721-024038_289466959","dateCreated":"2019-07-21T14:19:11+0200","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2142"},{"text":"def transformDS(datasets: => Seq[org.apache.spark.sql.Dataset[_ >: PageExit with PageEnter with PageTurn <: Product with Serializable with PageView]]) : Seq[org.apache.spark.sql.Dataset[UserEventTotal]] = datasets.map {\n    ds => {\n        \n        brochureClick.joinWith(ds, brochureClick.col(\"brochure_click_uuid\") === ds.col(\"brochure_click_uuid\"), \"left\").map{\n            case (click: BrochureClick, turn: PageView) => ClickEvent(click.user_ident, turn.page_view_mode)\n            case (click: BrochureClick, null) => ClickEvent(click.user_ident, Some(\"None\"))\n        }.map {\n            case ClickEvent(user_ident, Some(\"DOUBLE_PAGE_MODE\")) => UserEventCount(user_ident, Some(2))\n            case ClickEvent(user_ident, Some(\"SINGLE_PAGE_MODE\")) => UserEventCount(user_ident, Some(1))\n            case ClickEvent(user_ident, Some(\"None\")) => UserEventCount(user_ident, Some(0))\n        }.groupBy(\"user_ident\").agg(sum(\"event_count\") as \"total_events\").as[UserEventTotal]\n    }\n\n}","user":"anonymous","dateUpdated":"2019-07-21T14:19:11+0200","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"transformDS: (datasets: => Seq[org.apache.spark.sql.Dataset[_ >: PageExit with PageEnter with PageTurn <: Product with Serializable with PageView]])Seq[org.apache.spark.sql.Dataset[UserEventTotal]]\n"}]},"apps":[],"jobName":"paragraph_1563711551032_-1502178383","id":"20190721-030833_1415650687","dateCreated":"2019-07-21T14:19:11+0200","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2143"},{"text":"transformDS(datasets).foreach(ds => println(ds.count()))","user":"anonymous","dateUpdated":"2019-07-21T14:19:11+0200","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"23\n23\n23\n"}]},"apps":[],"jobName":"paragraph_1563711551034_-453597577","id":"20190721-041930_927150138","dateCreated":"2019-07-21T14:19:11+0200","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2144"},{"user":"anonymous","dateUpdated":"2019-07-21T14:19:11+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1563711551036_-1761649629","id":"20190721-110504_560236329","dateCreated":"2019-07-21T14:19:11+0200","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2145"}],"name":"Spark Dataset","id":"2EG41NVPG","noteParams":{},"noteForms":{},"angularObjects":{"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}